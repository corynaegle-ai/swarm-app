# Swarm Platform API - Deployment Manifest

service:
  name: swarm-platform
  description: "Core Swarm orchestration API"
  pm2_name: swarm-platform-dev
  port: 8080
  
repository:
  path: /opt/swarm-platform
  github: corynaegle-ai/swarm-platform
  branch: main
  
environment:
  target: dev
  droplet_ip: 134.199.235.140
  
build:
  pre_checks:
    - test -f package.json
  commands:
    - npm ci
  timeout: 120
  working_dir: /opt/swarm-platform
  
deploy:
  strategy: replace
  commands:
    - pm2 restart swarm-platform-dev --update-env
  timeout: 60
  
health_check:
  endpoint: http://localhost:8080/api/health
  method: GET
  expected_status: 200
  timeout: 30
  retries: 3
  retry_delay: 5
  
rollback:
  enabled: true
  strategy: git_revert
  commands:
    - git stash
    - git checkout HEAD^
    - npm ci
    - pm2 restart swarm-platform-dev --update-env
    
dependencies:
  services: []
  env_vars:
    - ANTHROPIC_API_KEY
    - GITHUB_TOKEN
    - DATABASE_PATH
    
notifications:
  on_success: true
  on_failure: true
  create_ticket: true
