<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SwarmStack | Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #F59E0B;
            --primary-dark: #D97706;
            --primary-light: #FBBF24;
            --dark: #0F172A;
            --dark-secondary: #1E293B;
            --dark-tertiary: #334155;
            --text-primary: #F8FAFC;
            --text-secondary: #94A3B8;
            --text-muted: #64748B;
            --border: rgba(255,255,255,0.08);
            --border-hover: rgba(255,255,255,0.15);
            --glow: rgba(245,158,11,0.4);
            --success: #10B981;
            --success-glow: rgba(16,185,129,0.3);
            --error: #EF4444;
            --error-glow: rgba(239,68,68,0.3);
            --warning: #F59E0B;
            --info: #3B82F6;
            --info-glow: rgba(59,130,246,0.3);
            --sidebar-width: 260px;
            --header-height: 64px;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--dark);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .bg-pattern {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: 
                radial-gradient(circle at 10% 20%, rgba(245,158,11,0.04) 0%, transparent 40%),
                radial-gradient(circle at 90% 80%, rgba(245,158,11,0.03) 0%, transparent 35%),
                radial-gradient(circle at 50% 50%, rgba(30,41,59,0.5) 0%, transparent 80%);
            z-index: -1;
        }
        
        .bg-grid {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background-image: 
                linear-gradient(rgba(255,255,255,0.02) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255,255,255,0.02) 1px, transparent 1px);
            background-size: 60px 60px;
            z-index: -1;
        }

        .app-container { display: flex; min-height: 100vh; }

        .sidebar {
            width: var(--sidebar-width);
            background: rgba(15,23,42,0.95);
            backdrop-filter: blur(20px);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            position: fixed;
            top: 0; left: 0; bottom: 0;
            z-index: 100;
            transition: transform 0.3s ease;
        }

        .sidebar-header { padding: 1.25rem 1.5rem; border-bottom: 1px solid var(--border); }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            text-decoration: none;
            color: var(--text-primary);
        }

        .logo-icon {
            width: 38px; height: 38px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            box-shadow: 0 4px 15px var(--glow);
        }

        .logo-text { font-weight: 700; font-size: 1.35rem; }
        .logo-text span { color: var(--primary); }

        .sidebar-nav { flex: 1; padding: 1rem 0; overflow-y: auto; }
        .nav-section { margin-bottom: 1.5rem; }

        .nav-section-title {
            padding: 0.5rem 1.5rem;
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            color: var(--text-muted);
            font-weight: 600;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1.5rem;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.2s;
            border-left: 3px solid transparent;
        }

        .nav-item:hover { color: var(--text-primary); background: rgba(255,255,255,0.03); }
        .nav-item.active { color: var(--primary); background: rgba(245,158,11,0.08); border-left-color: var(--primary); }
        .nav-item-icon { width: 20px; text-align: center; font-size: 1rem; }
        .nav-item-badge { margin-left: auto; padding: 0.15rem 0.5rem; background: var(--primary); color: var(--dark); font-size: 0.7rem; font-weight: 600; border-radius: 100px; }

        .sidebar-footer { padding: 1rem 1.5rem; border-top: 1px solid var(--border); }

        .user-card {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            background: rgba(255,255,255,0.03);
            border-radius: 10px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .user-card:hover { background: rgba(255,255,255,0.06); }

        .user-avatar {
            width: 36px; height: 36px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .user-info { flex: 1; min-width: 0; }
        .user-name { font-size: 0.85rem; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .user-role { font-size: 0.75rem; color: var(--text-muted); }

        .main-content { flex: 1; margin-left: var(--sidebar-width); display: flex; flex-direction: column; min-height: 100vh; }

        .header {
            height: var(--header-height);
            background: rgba(15,23,42,0.8);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 1.5rem;
            position: sticky;
            top: 0;
            z-index: 50;
        }

        .header-left { display: flex; align-items: center; gap: 1rem; }
        .mobile-menu-btn { display: none; background: none; border: none; color: var(--text-primary); font-size: 1.5rem; cursor: pointer; padding: 0.5rem; }
        .page-title { font-size: 1.25rem; font-weight: 600; }

        .connection-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.4rem 0.75rem;
            background: rgba(16,185,129,0.1);
            border: 1px solid rgba(16,185,129,0.2);
            border-radius: 100px;
            font-size: 0.8rem;
            color: var(--success);
        }
        .status-dot { width: 8px; height: 8px; background: var(--success); border-radius: 50%; }

        .header-right { display: flex; align-items: center; gap: 0.75rem; }
        .header-btn { padding: 0.5rem 1rem; border-radius: 8px; font-weight: 500; font-size: 0.85rem; cursor: pointer; transition: all 0.2s; border: none; display: flex; align-items: center; gap: 0.5rem; }
        .btn-secondary { background: var(--dark-secondary); color: var(--text-secondary); border: 1px solid var(--border); }
        .btn-secondary:hover { background: var(--dark-tertiary); color: var(--text-primary); border-color: var(--border-hover); }
        .btn-primary { background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: var(--dark); box-shadow: 0 4px 15px var(--glow); }
        .btn-primary:hover { transform: translateY(-1px); box-shadow: 0 6px 20px var(--glow); }

        .content-wrapper { flex: 1; padding: 1.5rem; overflow-y: auto; }

        .stats-row { display: grid; grid-template-columns: repeat(5, 1fr); gap: 1rem; margin-bottom: 1.5rem; }
        .stat-card { background: rgba(30,41,59,0.6); backdrop-filter: blur(10px); border: 1px solid var(--border); border-radius: 12px; padding: 1.25rem; transition: all 0.2s; }
        .stat-card:hover { border-color: var(--border-hover); transform: translateY(-2px); }
        .stat-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 0.75rem; }
        .stat-label { font-size: 0.8rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; }
        .stat-icon { width: 32px; height: 32px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 1rem; }
        .stat-value { font-size: 1.75rem; font-weight: 700; margin-bottom: 0.25rem; }
        .stat-change { font-size: 0.75rem; display: flex; align-items: center; gap: 0.25rem; }
        .stat-change.positive { color: var(--success); }
        .stat-change.negative { color: var(--error); }

        .dashboard-grid { display: grid; grid-template-columns: 1fr 380px; gap: 1.5rem; height: calc(100vh - var(--header-height) - 180px); min-height: 500px; }

        .vm-fleet { display: flex; flex-direction: column; background: rgba(30,41,59,0.4); backdrop-filter: blur(10px); border: 1px solid var(--border); border-radius: 16px; overflow: hidden; }
        .section-header { padding: 1rem 1.25rem; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; flex-shrink: 0; }
        .section-title { font-size: 1rem; font-weight: 600; display: flex; align-items: center; gap: 0.5rem; }
        .section-count { padding: 0.2rem 0.6rem; background: var(--dark-secondary); border-radius: 6px; font-size: 0.75rem; color: var(--text-muted); }
        .section-actions { display: flex; gap: 0.5rem; }
        .filter-input { padding: 0.4rem 0.75rem; background: var(--dark); border: 1px solid var(--border); border-radius: 6px; color: var(--text-primary); font-size: 0.8rem; width: 160px; transition: border-color 0.2s; }
        .filter-input:focus { outline: none; border-color: var(--primary); }
        .filter-select { padding: 0.4rem 0.75rem; background: var(--dark); border: 1px solid var(--border); border-radius: 6px; color: var(--text-secondary); font-size: 0.8rem; cursor: pointer; }

        .vm-grid { flex: 1; padding: 1rem; display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 0.75rem; overflow-y: auto; align-content: start; }
        .vm-card { background: rgba(15,23,42,0.6); border: 1px solid var(--border); border-radius: 10px; padding: 0.875rem; cursor: pointer; transition: all 0.2s; }
        .vm-card:hover { border-color: var(--border-hover); transform: translateY(-2px); }
        .vm-card.selected { border-color: var(--primary); box-shadow: 0 0 0 1px var(--primary), 0 8px 25px rgba(245,158,11,0.15); }
        .vm-card.working { border-left: 3px solid var(--success); }
        .vm-card.done { border-left: 3px solid var(--info); }
        .vm-card.error { border-left: 3px solid var(--error); }
        .vm-card.idle { border-left: 3px solid var(--text-muted); }
        .vm-card.booting { border-left: 3px solid var(--warning); }
        .vm-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem; }
        .vm-id { font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; font-weight: 600; }
        .vm-status { padding: 0.15rem 0.5rem; border-radius: 4px; font-size: 0.65rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; }
        .vm-status.working { background: rgba(16,185,129,0.15); color: var(--success); }
        .vm-status.done { background: rgba(59,130,246,0.15); color: var(--info); }
        .vm-status.error { background: rgba(239,68,68,0.15); color: var(--error); }
        .vm-status.idle { background: rgba(100,116,139,0.15); color: var(--text-muted); }
        .vm-status.booting { background: rgba(245,158,11,0.15); color: var(--warning); }
        .vm-task { font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 0.5rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .vm-progress { height: 3px; background: var(--dark-tertiary); border-radius: 2px; margin-bottom: 0.5rem; overflow: hidden; }
        .vm-progress-bar { height: 100%; background: linear-gradient(90deg, var(--success), var(--primary)); border-radius: 2px; transition: width 0.3s; }
        .vm-meta { display: flex; justify-content: space-between; font-size: 0.7rem; color: var(--text-muted); font-family: 'JetBrains Mono', monospace; }

        .right-panel { display: flex; flex-direction: column; gap: 1rem; }
        .detail-panel { flex: 1; background: rgba(30,41,59,0.4); backdrop-filter: blur(10px); border: 1px solid var(--border); border-radius: 16px; display: flex; flex-direction: column; overflow: hidden; min-height: 0; }
        .detail-header { padding: 1rem 1.25rem; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; flex-shrink: 0; }
        .detail-vm-info { display: flex; align-items: center; gap: 0.75rem; }
        .detail-vm-indicator { width: 10px; height: 10px; border-radius: 50%; background: var(--success); }
        .detail-vm-name { font-weight: 600; }
        .detail-vm-ip { font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; color: var(--text-muted); }
        .detail-stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.5rem; padding: 1rem 1.25rem; border-bottom: 1px solid var(--border); flex-shrink: 0; }
        .detail-stat { text-align: center; }
        .detail-stat-value { font-size: 1.1rem; font-weight: 700; }
        .detail-stat-value.success { color: var(--success); }
        .detail-stat-value.info { color: var(--info); }
        .detail-stat-value.warning { color: var(--warning); }
        .detail-stat-value.purple { color: #A78BFA; }
        .detail-stat-label { font-size: 0.65rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; }
        .detail-task { padding: 1rem 1.25rem; border-bottom: 1px solid var(--border); flex-shrink: 0; }
        .detail-task-label { font-size: 0.7rem; color: var(--text-muted); margin-bottom: 0.35rem; }
        .detail-task-text { font-size: 0.85rem; }
        .detail-task-branch { font-family: 'JetBrains Mono', monospace; font-size: 0.75rem; color: var(--text-muted); margin-top: 0.35rem; }

        .log-panel { flex: 1; display: flex; flex-direction: column; min-height: 0; }
        .log-header { padding: 0.75rem 1.25rem; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; flex-shrink: 0; }
        .log-title { font-size: 0.85rem; font-weight: 500; color: var(--text-secondary); }
        .log-actions { display: flex; gap: 0.5rem; }
        .log-btn { padding: 0.25rem 0.5rem; background: var(--dark); border: 1px solid var(--border); border-radius: 4px; color: var(--text-muted); font-size: 0.7rem; cursor: pointer; transition: all 0.2s; }
        .log-btn:hover { color: var(--text-secondary); border-color: var(--border-hover); }
        .log-content { flex: 1; overflow-y: auto; padding: 0.75rem 1.25rem; font-family: 'JetBrains Mono', monospace; font-size: 0.7rem; line-height: 1.6; }
        .log-line { display: flex; gap: 0.75rem; padding: 0.15rem 0; }
        .log-time { color: var(--text-muted); flex-shrink: 0; width: 55px; }
        .log-level { flex-shrink: 0; width: 42px; }
        .log-level.info { color: var(--text-secondary); }
        .log-level.debug { color: var(--text-muted); }
        .log-level.warn { color: var(--warning); }
        .log-level.error { color: var(--error); }
        .log-msg { color: var(--text-secondary); }
        .log-streaming { display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem 0; color: var(--text-muted); }
        .log-streaming-dot { width: 6px; height: 6px; background: var(--success); border-radius: 50%; }

        .detail-actions { padding: 0.75rem 1.25rem; border-top: 1px solid var(--border); display: flex; gap: 0.5rem; flex-shrink: 0; }
        .detail-btn { flex: 1; padding: 0.6rem; border-radius: 8px; font-size: 0.8rem; font-weight: 500; cursor: pointer; transition: all 0.2s; border: none; }
        .detail-btn.ssh { background: var(--dark-secondary); color: var(--text-secondary); border: 1px solid var(--border); }
        .detail-btn.ssh:hover { background: var(--dark-tertiary); color: var(--text-primary); }
        .detail-btn.pr { background: var(--dark-secondary); color: var(--text-secondary); border: 1px solid var(--border); }
        .detail-btn.pr:hover { background: var(--dark-tertiary); color: var(--text-primary); }
        .detail-btn.kill { background: rgba(239,68,68,0.1); color: var(--error); border: 1px solid rgba(239,68,68,0.2); }
        .detail-btn.kill:hover { background: rgba(239,68,68,0.2); }

        .bottom-panels { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
        .panel-card { background: rgba(30,41,59,0.4); backdrop-filter: blur(10px); border: 1px solid var(--border); border-radius: 12px; padding: 1rem; }
        .panel-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem; }
        .panel-title { font-size: 0.9rem; font-weight: 600; }
        .panel-badge { font-size: 0.7rem; color: var(--text-muted); }
        .panel-badge.success { color: var(--success); }
        .queue-item { display: flex; align-items: center; gap: 0.75rem; padding: 0.5rem 0; }
        .queue-number { width: 24px; height: 24px; background: var(--dark); border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 0.7rem; color: var(--text-muted); flex-shrink: 0; }
        .queue-text { font-size: 0.8rem; color: var(--text-secondary); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .pr-item { display: flex; align-items: center; gap: 0.75rem; padding: 0.5rem 0; }
        .pr-dot { width: 8px; height: 8px; background: var(--success); border-radius: 50%; flex-shrink: 0; }
        .pr-title { flex: 1; font-size: 0.8rem; color: var(--text-secondary); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .pr-number { font-size: 0.7rem; color: var(--text-muted); font-family: 'JetBrains Mono', monospace; }

        .mobile-overlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.6); z-index: 99; }
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: var(--dark-tertiary); border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--text-muted); }

        @media (max-width: 1400px) { .stats-row { grid-template-columns: repeat(5, 1fr); } }
        @media (max-width: 1200px) {
            .dashboard-grid { grid-template-columns: 1fr; height: auto; }
            .right-panel { flex-direction: row; }
            .detail-panel { flex: 1; max-height: 400px; }
            .bottom-panels { flex: 1; display: flex; flex-direction: column; gap: 1rem; }
        }
        @media (max-width: 1024px) {
            .stats-row { grid-template-columns: repeat(3, 1fr); }
            .stat-card:nth-child(4), .stat-card:nth-child(5) { grid-column: span 1; }
        }
        @media (max-width: 768px) {
            :root { --sidebar-width: 280px; }
            .sidebar { transform: translateX(-100%); }
            .sidebar.open { transform: translateX(0); }
            .mobile-overlay.open { display: block; }
            .main-content { margin-left: 0; }
            .mobile-menu-btn { display: block; }
            .stats-row { grid-template-columns: repeat(2, 1fr); }
            .stat-card:last-child { grid-column: span 2; }
            .right-panel { flex-direction: column; }
            .detail-panel { max-height: 350px; }
            .bottom-panels { grid-template-columns: 1fr; }
            .connection-status span:not(.status-dot) { display: none; }
            .header-btn span { display: none; }
            .header-btn { padding: 0.5rem; }
        }
        @media (max-width: 480px) {
            .content-wrapper { padding: 1rem; }
            .stats-row { grid-template-columns: 1fr; }
            .stat-card:last-child { grid-column: span 1; }
            .vm-grid { grid-template-columns: 1fr; }
            .detail-stats { grid-template-columns: repeat(2, 1fr); }
            .section-actions { display: none; }
        }
    </style>
</head>
<body>
    <div class="bg-pattern"></div>
    <div class="bg-grid"></div>

    <div class="app-container">
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/" class="logo">
                    <div class="logo-icon">üêù</div>
                    <div class="logo-text">Swarm<span>Stack</span></div>
                </a>
            </div>
            
            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">Overview</div>
                    <a href="#" class="nav-item active">
                        <span class="nav-item-icon">üìä</span>
                        Dashboard
                    </a>
                    <a href="#" class="nav-item">
                        <span class="nav-item-icon">üñ•Ô∏è</span>
                        VM Fleet
                        <span class="nav-item-badge">24</span>
                    </a>
                    <a href="#" class="nav-item">
                        <span class="nav-item-icon">üìã</span>
                        Tickets
                        <span class="nav-item-badge" id="ticketsBadge">8</span>
                    </a>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">Execution</div>
                    <a href="#" class="nav-item">
                        <span class="nav-item-icon">üöÄ</span>
                        Launch Swarm
                    </a>
                    <a href="#" class="nav-item">
                        <span class="nav-item-icon">üìù</span>
                        Spec Input
                    </a>
                    <a href="#" class="nav-item">
                        <span class="nav-item-icon">üîß</span>
                        Agent Templates
                    </a>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">Operations</div>
                    <a href="#" class="nav-item">
                        <span class="nav-item-icon">üì¶</span>
                        Snapshots
                    </a>
                    <a href="#" class="nav-item">
                        <span class="nav-item-icon">üîë</span>
                        Secrets
                    </a>
                    <a href="#" class="nav-item">
                        <span class="nav-item-icon">üìà</span>
                        Metrics
                    </a>
                    <a href="#" class="nav-item">
                        <span class="nav-item-icon">üìú</span>
                        Logs
                    </a>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">Settings</div>
                    <a href="#" class="nav-item">
                        <span class="nav-item-icon">‚öôÔ∏è</span>
                        Configuration
                    </a>
                    <a href="#" class="nav-item">
                        <span class="nav-item-icon">üîó</span>
                        API Keys
                    </a>
                </div>
            </nav>

            <div class="sidebar-footer">
                <div class="user-card">
                    <div class="user-avatar">CN</div>
                    <div class="user-info">
                        <div class="user-name">Cory Naegle</div>
                        <div class="user-role">Administrator</div>
                    </div>
                </div>
            </div>
        </aside>

        <div class="mobile-overlay" id="mobileOverlay" onclick="toggleSidebar()"></div>

        <main class="main-content">
            <header class="header">
                <div class="header-left">
                    <button class="mobile-menu-btn" onclick="toggleSidebar()">‚ò∞</button>
                    <h1 class="page-title">Dashboard</h1>
                    <div class="connection-status">
                        <span class="status-dot"></span>
                        <span>146.190.35.235</span>
                    </div>
                </div>
                <div class="header-right">
                    <button class="header-btn btn-secondary">
                        <span>‚öôÔ∏è</span>
                        <span>Settings</span>
                    </button>
                    <button class="header-btn btn-primary" onclick="spawnBatch()">
                        <span>+</span>
                        <span>Spawn Batch</span>
                    </button>
                </div>
            </header>

            <div class="content-wrapper">
                <div class="stats-row">
                    <div class="stat-card">
                        <div class="stat-header">
                            <span class="stat-label">Total VMs</span>
                            <div class="stat-icon" style="background: rgba(245,158,11,0.1);">üñ•Ô∏è</div>
                        </div>
                        <div class="stat-value" id="totalVMs">24</div>
                        <div class="stat-change positive">‚Üë 10 from last batch</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <span class="stat-label">Working</span>
                            <div class="stat-icon" style="background: rgba(16,185,129,0.1);">‚ö°</div>
                        </div>
                        <div class="stat-value" style="color: var(--success);" id="workingVMs">8</div>
                        <div class="stat-change positive">Active agents</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <span class="stat-label">Completed</span>
                            <div class="stat-icon" style="background: rgba(59,130,246,0.1);">‚úì</div>
                        </div>
                        <div class="stat-value" style="color: var(--info);" id="doneVMs">12</div>
                        <div class="stat-change positive">‚Üë 4 this hour</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <span class="stat-label">Errors</span>
                            <div class="stat-icon" style="background: rgba(239,68,68,0.1);">‚ö†Ô∏è</div>
                        </div>
                        <div class="stat-value" style="color: var(--error);" id="errorVMs">2</div>
                        <div class="stat-change negative">‚Üë 1 needs attention</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <span class="stat-label">Est. Cost</span>
                            <div class="stat-icon" style="background: rgba(167,139,250,0.1);">üí∞</div>
                        </div>
                        <div class="stat-value" style="color: #A78BFA;">$0.42</div>
                        <div class="stat-change" style="color: var(--text-muted);">/hour</div>
                    </div>
                </div>

                <div class="dashboard-grid">
                    <div class="vm-fleet">
                        <div class="section-header">
                            <div class="section-title">
                                VM Fleet
                                <span class="section-count" id="vmCount">24 VMs</span>
                            </div>
                            <div class="section-actions">
                                <input type="text" class="filter-input" placeholder="Filter VMs..." id="vmFilter">
                                <select class="filter-select" id="statusFilter">
                                    <option value="">All Statuses</option>
                                    <option value="working">Working</option>
                                    <option value="done">Done</option>
                                    <option value="error">Error</option>
                                    <option value="idle">Idle</option>
                                    <option value="booting">Booting</option>
                                </select>
                            </div>
                        </div>
                        <div class="vm-grid" id="vmGrid"></div>
                    </div>

                    <div class="right-panel">
                        <div class="detail-panel" id="detailPanel">
                            <div class="detail-header">
                                <div class="detail-vm-info">
                                    <div class="detail-vm-indicator" id="detailIndicator"></div>
                                    <span class="detail-vm-name" id="detailVmName">VM 0</span>
                                    <span class="detail-vm-ip" id="detailVmIp">10.0.0.2</span>
                                </div>
                                <span class="vm-status working" id="detailStatus">working</span>
                            </div>

                            <div class="detail-stats">
                                <div class="detail-stat">
                                    <div class="detail-stat-value success" id="detailProgress">67%</div>
                                    <div class="detail-stat-label">Progress</div>
                                </div>
                                <div class="detail-stat">
                                    <div class="detail-stat-value info" id="detailCommits">2</div>
                                    <div class="detail-stat-label">Commits</div>
                                </div>
                                <div class="detail-stat">
                                    <div class="detail-stat-value warning" id="detailMemory">92MB</div>
                                    <div class="detail-stat-label">Memory</div>
                                </div>
                                <div class="detail-stat">
                                    <div class="detail-stat-value purple" id="detailUptime">12m</div>
                                    <div class="detail-stat-label">Uptime</div>
                                </div>
                            </div>

                            <div class="detail-task">
                                <div class="detail-task-label">Current Task</div>
                                <div class="detail-task-text" id="detailTask">Fix ESLint errors in src/</div>
                                <div class="detail-task-branch" id="detailBranch">swarm/agent-0-abc123</div>
                            </div>

                            <div class="log-panel">
                                <div class="log-header">
                                    <span class="log-title">Live Logs</span>
                                    <div class="log-actions">
                                        <button class="log-btn">Pause</button>
                                        <button class="log-btn">Clear</button>
                                    </div>
                                </div>
                                <div class="log-content" id="logContent"></div>
                            </div>

                            <div class="detail-actions">
                                <button class="detail-btn ssh">SSH Connect</button>
                                <button class="detail-btn pr">View PR</button>
                                <button class="detail-btn kill">Kill</button>
                            </div>
                        </div>

                        <div class="bottom-panels">
                            <div class="panel-card">
                                <div class="panel-header">
                                    <span class="panel-title">Task Queue</span>
                                    <span class="panel-badge">8 pending</span>
                                </div>
                                <div id="taskQueue"></div>
                            </div>
                            <div class="panel-card">
                                <div class="panel-header">
                                    <span class="panel-title">Recent PRs</span>
                                    <span class="panel-badge success">4 opened</span>
                                </div>
                                <div id="recentPRs"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        const statuses = ['idle', 'working', 'done', 'error', 'booting'];
        const tasks = [
            'Fix ESLint errors in src/',
            'Add unit tests for auth module',
            'Refactor database queries',
            'Update API documentation',
            'Implement caching layer',
            'Fix memory leak in worker',
            'Add input validation',
            'Optimize image loading',
            'Fix race condition',
            'Add error boundaries',
        ];

        function generateVMs(count) {
            return Array.from({ length: count }, (_, i) => ({
                id: i,
                ip: `10.0.0.${i + 2}`,
                status: statuses[Math.floor(Math.random() * statuses.length)],
                task: tasks[Math.floor(Math.random() * tasks.length)],
                branch: `swarm/agent-${i}-${Math.random().toString(36).substr(2, 6)}`,
                progress: Math.floor(Math.random() * 100),
                memory: Math.floor(80 + Math.random() * 40),
                uptime: Math.floor(Math.random() * 3600),
                commits: Math.floor(Math.random() * 5),
            }));
        }

        const logs = [
            { time: '00:00:01', level: 'info', msg: 'Snapshot restored in 8ms' },
            { time: '00:00:02', level: 'info', msg: 'Network interface configured' },
            { time: '00:00:03', level: 'info', msg: 'SSH key loaded from /root/.ssh/swarm_github' },
            { time: '00:00:04', level: 'info', msg: 'Cloning repository...' },
            { time: '00:00:12', level: 'info', msg: 'Repository cloned successfully' },
            { time: '00:00:13', level: 'info', msg: 'Creating branch swarm/agent-0' },
            { time: '00:00:14', level: 'info', msg: 'Starting Claude Code session...' },
            { time: '00:00:15', level: 'debug', msg: 'Claude Code v2.0.59 initialized' },
            { time: '00:00:16', level: 'info', msg: 'Task: "Fix ESLint errors in src/"' },
            { time: '00:00:20', level: 'debug', msg: 'Analyzing codebase structure...' },
            { time: '00:00:35', level: 'info', msg: 'Found 12 files with ESLint errors' },
            { time: '00:00:42', level: 'debug', msg: 'Processing src/components/Button.tsx' },
            { time: '00:00:58', level: 'info', msg: 'Fixed 3 errors in Button.tsx' },
            { time: '00:01:15', level: 'debug', msg: 'Processing src/utils/helpers.ts' },
            { time: '00:01:28', level: 'warn', msg: 'Complex fix required - using multi-step approach' },
            { time: '00:01:45', level: 'info', msg: 'Fixed 5 errors in helpers.ts' },
        ];

        let tickets = [];
        const API_URL = 'https://api.swarmstack.net';
        
        async function fetchTickets() {
            try {
                const res = await fetch(`${API_URL}/tickets`);
                const data = await res.json();
                tickets = data.tickets || [];
                renderTaskQueue();
                updateTicketStats();
            } catch (err) {
                console.error('Failed to fetch tickets:', err);
            }
        }

        const recentPRs = [
            { title: 'fix: resolve ESLint errors', number: 142 },
            { title: 'feat: add input validation', number: 141 },
            { title: 'refactor: database queries', number: 140 },
            { title: 'docs: update API reference', number: 139 },
        ];

        let vms = generateVMs(24);
        let selectedVM = vms[0];

        function renderVMs() {
            const grid = document.getElementById('vmGrid');
            const filter = document.getElementById('vmFilter').value.toLowerCase();
            const statusFilter = document.getElementById('statusFilter').value;

            const filtered = vms.filter(vm => {
                const matchesText = vm.task.toLowerCase().includes(filter) || 
                                   vm.ip.includes(filter) ||
                                   `vm ${vm.id}`.includes(filter);
                const matchesStatus = !statusFilter || vm.status === statusFilter;
                return matchesText && matchesStatus;
            });

            grid.innerHTML = filtered.map(vm => `
                <div class="vm-card ${vm.status} ${selectedVM.id === vm.id ? 'selected' : ''}" 
                     onclick="selectVM(${vm.id})">
                    <div class="vm-header">
                        <span class="vm-id">VM ${vm.id}</span>
                        <span class="vm-status ${vm.status}">${vm.status}</span>
                    </div>
                    <div class="vm-task">${vm.task}</div>
                    ${vm.status === 'working' ? `
                        <div class="vm-progress">
                            <div class="vm-progress-bar" style="width: ${vm.progress}%"></div>
                        </div>
                    ` : ''}
                    <div class="vm-meta">
                        <span>${vm.ip}</span>
                        <span>${vm.memory}MB</span>
                    </div>
                </div>
            `).join('');

            document.getElementById('vmCount').textContent = `${filtered.length} VMs`;
        }

        function renderDetail() {
            const vm = selectedVM;
            document.getElementById('detailVmName').textContent = `VM ${vm.id}`;
            document.getElementById('detailVmIp').textContent = vm.ip;
            document.getElementById('detailStatus').textContent = vm.status;
            document.getElementById('detailStatus').className = `vm-status ${vm.status}`;
            document.getElementById('detailProgress').textContent = `${vm.progress}%`;
            document.getElementById('detailCommits').textContent = vm.commits;
            document.getElementById('detailMemory').textContent = `${vm.memory}MB`;
            document.getElementById('detailUptime').textContent = `${Math.floor(vm.uptime / 60)}m`;
            document.getElementById('detailTask').textContent = vm.task;
            document.getElementById('detailBranch').textContent = vm.branch;
            const indicator = document.getElementById('detailIndicator');
            const colors = { working: 'var(--success)', done: 'var(--info)', error: 'var(--error)', idle: 'var(--text-muted)', booting: 'var(--warning)' };
            indicator.style.background = colors[vm.status];
        }

        function renderLogs() {
            const content = document.getElementById('logContent');
            content.innerHTML = logs.map(log => `
                <div class="log-line">
                    <span class="log-time">${log.time}</span>
                    <span class="log-level ${log.level}">${log.level.toUpperCase()}</span>
                    <span class="log-msg">${log.msg}</span>
                </div>
            `).join('') + `<div class="log-streaming"><span class="log-streaming-dot"></span><span>Streaming...</span></div>`;
        }

        function renderTaskQueue() {
            const queue = document.getElementById('taskQueue');
            const readyTickets = tickets.filter(t => t.state === 'ready').slice(0, 5);
            document.querySelector('.panel-card .panel-badge').textContent = `${tickets.filter(t => t.state === 'ready').length} pending`;
            queue.innerHTML = readyTickets.map((ticket, i) => `
                <div class="queue-item">
                    <span class="queue-number">${i + 1}</span>
                    <span class="queue-text" title="${ticket.id}: ${ticket.title}">${ticket.id}: ${ticket.title}</span>
                </div>
            `).join('') || '<div style="color: var(--text-muted); font-size: 0.8rem;">No pending tickets</div>';
        }
        
        function updateTicketStats() {
            const ready = tickets.filter(t => t.state === 'ready').length;
            const done = tickets.filter(t => t.state === 'done').length;
            const blocked = tickets.filter(t => t.state === 'blocked').length;
            const inProgress = tickets.filter(t => t.assignee_id && t.state !== 'done').length;
            // Update sidebar badge
            const ticketsBadge = document.getElementById('ticketsBadge');
            if (ticketsBadge) ticketsBadge.textContent = ready;
        }

        function renderPRs() {
            const prs = document.getElementById('recentPRs');
            prs.innerHTML = recentPRs.map(pr => `
                <div class="pr-item">
                    <span class="pr-dot"></span>
                    <span class="pr-title">${pr.title}</span>
                    <span class="pr-number">#${pr.number}</span>
                </div>
            `).join('');
        }

        function updateStats() {
            const stats = { total: vms.length, working: vms.filter(v => v.status === 'working').length, done: vms.filter(v => v.status === 'done').length, error: vms.filter(v => v.status === 'error').length };
            document.getElementById('totalVMs').textContent = stats.total;
            document.getElementById('workingVMs').textContent = stats.working;
            document.getElementById('doneVMs').textContent = stats.done;
            document.getElementById('errorVMs').textContent = stats.error;
        }

        function selectVM(id) { selectedVM = vms.find(vm => vm.id === id); renderVMs(); renderDetail(); }
        function toggleSidebar() { document.getElementById('sidebar').classList.toggle('open'); document.getElementById('mobileOverlay').classList.toggle('open'); }
        function spawnBatch() {
            const newVMs = generateVMs(10).map((vm, i) => ({ ...vm, id: vms.length + i, status: 'booting', ip: `10.0.0.${vms.length + i + 2}` }));
            vms = [...vms, ...newVMs];
            renderVMs(); updateStats();
        }

        document.getElementById('vmFilter').addEventListener('input', renderVMs);
        document.getElementById('statusFilter').addEventListener('change', renderVMs);

        setInterval(() => {
            vms = vms.map(vm => ({ ...vm, progress: vm.status === 'working' ? Math.min(100, vm.progress + Math.floor(Math.random() * 3)) : vm.progress, memory: Math.floor(80 + Math.random() * 40) }));
            selectedVM = vms.find(vm => vm.id === selectedVM.id);
            renderVMs(); renderDetail();
        }, 3000);

        // Refresh tickets every 10 seconds
        setInterval(fetchTickets, 10000);

        renderVMs(); renderDetail(); renderLogs(); fetchTickets(); renderPRs(); updateStats();
    </script>
</body>
</html>
